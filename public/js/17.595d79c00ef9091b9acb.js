webpackJsonp([17],{Cd39:function(e,t,r){var a=r("VU/8")(r("xG36"),r("k1VJ"),!1,function(e){r("pEqM")},null,null);e.exports=a.exports},em5V:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stack_error=function(e){var t="";Object.keys(e).map(function(r,a){var o=e[r];t+='<span style="color: #e74c3c">'+o[0]+"</span><br>"}),swal({title:"Error Text!",type:"error",text:t,html:!0})}},k1VJ:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"row"},[r("div",{staticClass:"ibox"},[r("div",{staticClass:"ibox-title"},[r("h5",[r("blockquote",[e._v(e._s(e.$t("el.page.applicat")))])])]),e._v(" "),r("div",{staticClass:"ibox-content"},[r("div",{staticClass:"row",staticStyle:{"margin-top":"15px"}},[r("el-form",{ref:"ruleForm",staticClass:"col-md-8 col-md-offset-2",attrs:{model:e.form,rules:e.rules,"label-position":e.isPhone?"top":"right","label-width":"90px"}},[r("el-form-item",{staticStyle:{color:"red"},attrs:{label:e.$t("el.form.principal"),prop:"principal"}},[r("el-col",{staticStyle:{"min-width":"90px"},attrs:{xs:24,sm:8,md:8}},[r("el-input",{model:{value:e.form.principal,callback:function(t){e.$set(e.form,"principal",t)},expression:"form.principal"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("el.form.mobile"),prop:"mobile"}},[r("el-col",{staticStyle:{"min-width":"90px"},attrs:{xs:24,sm:8,md:8}},[r("el-input",{model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",e._n(t))},expression:"form.mobile"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("el.form.mechanism"),prop:"mechanism"}},[r("el-select",{attrs:{"allow-create":"",filterable:"",placeholder:e.$t("el.select.placeholder")},model:{value:e.form.mechanism_id,callback:function(t){e.$set(e.form,"mechanism_id",t)},expression:"form.mechanism_id"}},e._l(e.options,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("el.form.participate_number")}},[r("el-col",{staticStyle:{"min-width":"90px"},attrs:{span:5}},[r("el-input-number",{attrs:{min:1,max:3e3},model:{value:e.form.number,callback:function(t){e.$set(e.form,"number",e._n(t))},expression:"form.number"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("el.form.applay_type"),prop:"type_id"}},[r("el-cascader",{attrs:{placeholder:e.$t("el.form.type_placeholder"),options:e.types,filterable:!e.isPhone,"show-all-levels":!1,props:e.props,clearable:!0},model:{value:e.form.type_id,callback:function(t){e.$set(e.form,"type_id",t)},expression:"form.type_id"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("el.form.borrow_period"),required:""}},[e.isPhone?[r("el-col",{attrs:{xs:24,sm:11,md:11}},[r("el-form-item",{attrs:{prop:"startTime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:e.$t("el.form.start_time"),"picker-options":e.startPickerOptions,editable:!1},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}})],1)],1),e._v(" "),r("el-col",{staticClass:"line",staticStyle:{"text-align":"center"},attrs:{xs:24,sm:2,md:2}},[e._v("-")]),e._v(" "),r("el-col",{attrs:{xs:24,sm:11,md:11}},[r("el-form-item",{attrs:{prop:"endTime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:e.$t("el.form.end_time"),"picker-options":e.endPickerOptions,editable:!1},model:{value:e.form.endTime,callback:function(t){e.$set(e.form,"endTime",t)},expression:"form.endTime"}})],1)],1)]:r("el-col",{attrs:{span:15}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetimerange","picker-options":e.startPickerOptions,placeholder:e.$t("el.form.start_end_time")},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1)],2),e._v(" "),r("el-form-item",{attrs:{label:e.$t("el.form.applay_unite")}},[r("el-switch",{attrs:{"on-text":e.$t("el.form.have"),"off-text":e.$t("el.form.not")},model:{value:e.form.unite,callback:function(t){e.$set(e.form,"unite",t)},expression:"form.unite"}})],1),e._v(" "),e.form.unite?r("el-form-item",{attrs:{label:e.$t("el.form.agency"),prop:"agrncy"}},[r("el-input",{attrs:{type:"textarea",autosize:""},model:{value:e.form.agency,callback:function(t){e.$set(e.form,"agency",t)},expression:"form.agency"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:e.$t("el.form.applay_reason"),prop:"reason"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.form.reason,callback:function(t){e.$set(e.form,"reason",t)},expression:"form.reason"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("el.form.goods"),prop:"goods"}},[r("el-input",{attrs:{type:"textarea",placeholder:e.$t("el.form.goods_placeholder")},model:{value:e.form.goods,callback:function(t){e.$set(e.form,"goods",t)},expression:"form.goods"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("el.form.activity_planning")}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"/api/applicat/file",accept:"application/msword,application/msexcel,application/pdf",headers:e.headers,"on-remove":e.handleRemove,"on-success":e.handleSuccess,"on-error":e.handleError,"before-upload":e.handleUpload,"file-list":e.fileList}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v(e._s(e.$t("el.form.upload_btn")))]),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[r("span",{staticStyle:{"line-height":"15px"}},[e._v(e._s(e.$t("el.form.upload_tip")))])])],1)],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.onSubmit("ruleForm")}}},[e._v(e._s(e.$t("el.form.applay_btn")))])],1)],1)],1)])])])},staticRenderFns:[]}},m1c8:function(e,t,r){(e.exports=r("FZ+f")(!1)).push([e.i,"input[type=file]{display:none}.upload-demo{line-height:0}",""])},pEqM:function(e,t,r){var a=r("m1c8");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r("rjj0")("209575ea",a,!0,{})},xG36:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},i=r("NYxO"),s=r("WmUf"),l=(a=s)&&a.__esModule?a:{default:a},n=r("em5V");t.default={data:function(){var e=this,t=function(t,r,a){""==r?a(new Error("请选择日期")):""!=e.form.startTime&&""!=e.form.endTime&&e.form.startTime>e.form.endTime?a(new Error("开始的日期不能大过结束日期")):a()};return{startPickerOptions:{selectableRange:"18:30:00 - 20:30:00"},endPickerOptions:{},dateTakeUp:[],date:[],form:{principal:"",mobile:"",mechanism_id:"",number:1,startTime:"",endTime:"",agency:"",unite:!1,type_id:[],reason:"",goods:"",fileList:[]},fileList:[],rules:{principal:[{required:!0,message:"请输入负责人名称",trigger:"blur"},{min:2,max:5,message:"长度在 2 到 5 个字符",trigger:"blur"}],mobile:[{type:"number",required:!0,message:"请填写联系方式",trigger:"blur"},{validator:function(e,t,r){new RegExp(/^1[34578][0-9]{9}$/).test(t)?r():r(new Error("联系方式的格式不正确"))},trigger:"blur"}],mechanism:[{validator:function(t,r,a){e.form.mechanism_id>0?a():a(new Error("请选择申请机构"))},trigger:"change"}],type_id:[{type:"array",required:!0,message:"请选择申请类型",trigger:"change"}],startTime:[{validator:t,required:!0,trigger:"change"}],endTime:[{validator:t,required:!0,trigger:"change"}],reason:[{required:!0,message:"请输入您的申请缘由",trigger:"blur"}],agrncy:[{max:100,message:"长度不得超过100个字符",trigger:"blur"}],goods:[{max:100,message:"长度不得超过100个字符",tigger:"blur"}]},labelPosition:"left",headers:{},types:[],props:{value:"id",label:"name",disabled:"disabled"},options:[]}},created:function(){var e=this;this.headers={Authorization:"Bearer "+this.$store.state.access_token,"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},this.startPickerOptions.disabledDate=function(e){return e.getTime()<Date.now()-864e5},this.endPickerOptions.disabledDate=function(t){return t.getTime()<Date.now()-864e5||t.getTime()<e.form.startTime},axios.get(l.default.api.type+"?structure=tree").then(function(t){e.types=t.data},function(e){toastr.error(e.response.status+" : Resource "+e.response.statusText)}),axios.get(l.default.api.mechanism).then(function(t){e.options=t.data},function(e){toastr.error(e.response.status+" : Resource "+e.response.statusText)})},computed:o({},(0,i.mapState)(["isPhone"])),methods:{onSubmit:function(e){var t=this;t.$refs[e].validate(function(e){if(!e)return!1;t.form.fileList=t.fileList,t.date.length>0?(t.form.startTime=t.formatDataTime(t.date[0]),t.form.endTime=t.formatDataTime(t.date[1])):(t.form.startTime=t.formatDataTime(t.form.startTime),t.form.endTime=t.formatDataTime(t.form.endTime)),axios.post(l.default.api.applicat,t.form).then(function(e){toastr.success(t.$t("el.notification.create_applicat")),t.$router.push("/applicat-manage")},function(e){422==e.response.status?(0,n.stack_error)(e.response.data):toastr.error(e.response.status+" : Resource "+e.response.statusText)})})},handleRemove:function(e,t){if(e){var r=e.response.relative_url,a=this;axios.post("/api/file/delete",{path:r.substring(r.indexOf("/")+1)}).then(function(e){a.fileList=t},function(e){toastr.error(e.response.status+" : Resource "+e.response.statusText)})}},handleSuccess:function(e,t,r){e.success?this.fileList=r:((0,n.stack_error)(e.errors),r.splice(-1,1))},handleUpload:function(e){if(!(e.size/1024/1024<2))return toastr.warning("上传活动筹划大小不能超过 2MB!"),!1;for(var t=this.fileList,r=!0,a=0;a<t.length;a++)if(this.fileEqual(t[a].raw,e)){r=!1;break}return r},fileEqual:function(e,t){if(e.lastModified===t.lastModified&&e.name===t.name&&e.size===t.size&&e.type===t.type)return!0},currentType:function(e,t){for(var r=0;r<e.length;r++)if(e[r].id==t)return e[r].children?e[r].children:e[r]},formatDataTime:function(e){if(e.getFullYear){var t=e.getFullYear(),r=e.getMonth()+1;r=r<10?"0"+r:r;var a=e.getDate();a=a<10?"0"+a:a;var o=e.getHours(),i=e.getMinutes();return t+"-"+r+"-"+a+" "+o+":"+(i=i<10?"0"+i:i)}return e},handleError:function(e){console.log(e)}}}}});