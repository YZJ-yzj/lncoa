webpackJsonp([2],{"2rF3":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=Object.assign||function(t){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},s=e("NYxO"),r=n(e("qLXb")),o=n(e("MVox")),l=n(e("WmUf"));function n(t){return t&&t.__esModule?t:{default:t}}a.default={data:function(){return{applicats:[],applicat:{},id:"",form:{radio:"",opinion:"",fileList:[]},forward_form:{opinion:null,role_id:null},appraisal_form:{appraisal:null,score:null},total:0,totalPage:0,currentPage:0,pageSize:10,headers:{},fileList:[],roles:null,users:null,keyWord:"",rate:null,activeName:"detail",loading:!1}},created:function(){this.headers={Authorization:"Bearer "+this.$store.state.access_token,"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},this.currentPage=this.$route.query.page,this.pageSize=parseInt(this.$route.query.pageSize),this.loadData(),"/review/details"!=this.$route.fullPath&&this.loadCurrentData()},watch:{"$route.params":"currentApplicat"},components:{Status:r.default,TimeInterval:o.default},computed:i({},(0,s.mapState)(["isPhone","user"]),{applicatlist:function(){var t=this;return this.applicats.filter(function(a){return(a.mechanism+"-"+a.type).indexOf(t.keyWord)>=0||a.principal.indexOf(t.keyWord)>=0})},appraisalCanSubmit:function(){return null!=this.appraisal_form.appraisal||null!=this.appraisal_form.score},show:function(){return!$.isEmptyObject(this.applicat)}}),methods:i({},(0,s.mapMutations)(["DELETE_NOTIFICAT"]),{loadData:function(){var t=this;this.loading=!0,this.id=this.$route.params.id;var a="/api/applicats?include=opinions";if(this.currentPage){a=a+(-1!=a.indexOf("?")?"&page=":"?page=")+this.currentPage,this.$router.push("?page="+this.currentPage)}if(this.pageSize>10){a=a+(-1!=a.indexOf("?")?"&pageSize=":"?pageSize=")+this.pageSize,this.$router.push("?pageSize="+this.pageSize)}axios.get(a).then(function(a){t.applicats=a.data.data,t.totalPage=a.data.meta.pagination.total_pages,t.currentPage=a.data.meta.pagination.current_page,t.total=a.data.meta.pagination.total,t.loading=!1})},loadCurrentData:function(){var t=this;axios.get("/api/applicat/"+this.$route.params.id+"?include=opinions").then(function(a){t.applicat=a.data.data,t.DELETE_NOTIFICAT(t.applicat.id)})},currentApplicat:function(){for(var t=0;t<this.applicats.length;t++)if(this.applicats[t].id==this.$route.params.id){this.applicat=this.applicats[t],this.DELETE_NOTIFICAT(this.applicats[t].id);break}this.form.opinion="",this.form.radio=""},handleSizeChange:function(t){this.pageSize=t,this.loadData()},handleCurrentChange:function(t){this.currentPage=t,this.loadData()},handleRemove:function(t,a){if(t){var e=t.response.relative_url,i=this;axios.post("/api/file/delete",{path:e.substring(e.indexOf("/")+1)}).then(function(t){i.fileList=a},function(t){toastr.error(t.response.status+" : Resource "+t.response.statusText)})}},handleSuccess:function(t,a,e){t.success?this.fileList=e:(stack_error(t.errors),e.splice(-1,1))},handleUpload:function(t){for(var a=this.fileList,e=!0,i=0;i<a.length;i++)if(this.fileEqual(a[i].raw,t)){e=!1;break}return e},fileEqual:function(t,a){if(t.lastModified===a.lastModified&&t.name===a.name&&t.size===a.size&&t.type===a.type)return!0},forwardClick:function(t){var a=this;"forward"!=t.name||this.roles||axios.get(l.default.api.roles).then(function(t){a.roles=t.data.data})},roleChange:function(){var t=this;this.forward_form.user_id="",axios.get("/api/role/"+this.forward_form.role_id+"/users").then(function(a){t.users=a.data.data})},submit:function(){var t=this,a=this;a.form.applicat_id=a.$route.params.id,a.form.fileList=a.fileList,axios.post("/api/opinion/",a.form).then(function(e){toastr.success(a.$t("el.notification.review_success")),t.removeCurrentApplicat(),a.$router.push("/review/details")},function(t){toastr.error(t.response.status+" : Resource "+t.response.statusText)})},forward:function(t){var a=this;axios.post("/api/applicat/"+this.$route.params.id+"/forward",this.forward_form).then(function(t){toastr.success("申请已转发!"),a.removeCurrentApplicat(),a.$router.push("/review/details")})},approval:function(t){var a=this;"审核通过"==t.status&&axios.put("/api/applicat/"+this.$route.params.id+"/approval").then(function(e){t.status="进行中";for(var i=0;i<a.applicats.length;i++)a.applicats[i].id!=t.id||(a.applicats[i].status="进行中");a.activeName="detail",toastr.success("审批成功!")})},appraisal:function(t){var a=this;axios.post("/api/applicat/"+this.$route.params.id+"/appraisal",this.appraisal_form).then(function(t){a.removeCurrentApplicat(),a.$router.push("/review/details")},function(t){toastr.error(t.response.status+" : Resource "+t.response.statusText)})},end:function(t){var a=this;axios.put("/api/applicat/"+this.$route.params.id+"/end").then(function(e){t.status="待评价";for(var i=0;i<a.applicats.length;i++)a.applicats[i].id!=t.id||(a.applicats[i].status="待评价");a.activeName="detail"},function(t){toastr.error(t.response.status+" : Resource "+t.response.statusText)})},removeCurrentApplicat:function(){for(var t=0;t<this.applicats.length;t++)if(this.applicats[t].id==this.applicat.id)return this.applicats.splice(t,1),this.applicat={},void(this.fileList=[])}})}},"3cCa":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default={data:function(){return{timeinterval:""}},props:{date:{required:!0,default:function(){}}},created:function(){this.timeinterval=this.formatMsgTime(this.date)},methods:{formatMsgTime:function(t){var a={};if("number"==typeof t){var e=new Date(1e3*parseInt(t));a=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}else"string"==typeof t&&(a=t);var i=new Date,s=a;s=s.replace(/\-/g,"/");var r=new Date(s),o=i.getTime()-r.getTime(),l=parseInt(o/parseInt(864e5));o%=parseInt(864e5);var n=parseInt(o/parseInt(36e5));o%=parseInt(36e5);var p=parseInt(o/parseInt(6e4));o%=parseInt(6e4);var c=parseInt(o/parseInt(1e3)),d=this.$t("el.table.day"),u=this.$t("el.table.hour"),f=this.$t("el.table.minute"),v=this.$t("el.table.second");return l>=1?l+d:n>=1?n+u:p>=1?p+f:c+v}}}},"8njy":function(t,a,e){var i=e("HIzp");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);e("rjj0")("d86f6616",i,!0,{})},FJIu:function(t,a,e){(t.exports=e("FZ+f")(!1)).push([t.i,"a[data-v-193e4995]{text-decoration:none;-webkit-text-decoration-line:none;text-decoration-line:none}#review-details div[class*=col-][data-v-193e4995]{position:relative;min-height:1px;padding-left:0;padding-right:0}#review-details .ibox[data-v-193e4995]{margin-bottom:10px}.tabs .dl-horizontal li[data-v-193e4995]{list-style-type:none;-webkit-transition:all .5s cubic-bezier(.55,0,.1,1);transition:all .5s cubic-bezier(.55,0,.1,1);font-size:14px;color:#48576a;line-height:1.8;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:4px;width:100%;position:relative}.tabs .dl-horizontal li[data-v-193e4995]:hover{background-color:#eef1f6}.tabs .dl-horizontal .filename[data-v-193e4995]{color:#48576a;display:block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;padding-left:5px}.tabs .media-body .upload-demo[data-v-193e4995]{padding-bottom:15px}.tabs .forward .el-form-item[data-v-193e4995],.tabs .forward .opinion[data-v-193e4995]{margin-bottom:10px}.media-body .opinion[data-v-193e4995]{margin-bottom:15px}.media-body .media-body .el-radio-button__inner[data-v-193e4995]{padding:6px 15px}.feed-element img.img-circle[data-v-193e4995]{width:38px;height:38px;border-radius:50%}.feed-element>.pull-left[data-v-193e4995]{margin-right:10px}.current[data-v-193e4995]{background-color:#f5f5f5}@media (min-width:768px){.apply-list[data-v-193e4995]{padding-right:15px!important}}",""])},HIzp:function(t,a,e){(t.exports=e("FZ+f")(!1)).push([t.i,".status{margin-left:8px}",""])},Lam7:function(t,a,e){var i=e("FJIu");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);e("rjj0")("0ba0dd9f",i,!0,{})},MVox:function(t,a,e){var i=e("VU/8")(e("3cCa"),e("qe6d"),!1,function(t){e("ruFp")},null,null);t.exports=i.exports},WWaS:function(t,a){t.exports={render:function(){var t=this,a=t.$createElement;return(t._self._c||a)("span",{staticClass:"label label-primary",class:[{"label-warning":"待审核"==t.status},{"label-info":"审核中"==t.status},{"label-success":"审核通过"==t.status},{"label-danger":"审核不通过"==t.status},{status:t.statusClass}]},[t._v(t._s(t.status))])},staticRenderFns:[]}},WaYh:function(t,a,e){var i=e("VU/8")(e("2rF3"),e("iG3O"),!1,function(t){e("Lam7")},"data-v-193e4995",null);t.exports=i.exports},b3bp:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default={props:{status:{type:String,default:"待审核"},statusClass:{type:Boolean,default:!0}}}},iG3O:function(t,a){t.exports={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"row",attrs:{id:"review-details"}},[e("div",{staticClass:"col-md-12 "},[e("div",{staticClass:"col-md-4 col-xs-12 apply-list"},[e("div",{staticClass:"ibox"},[e("div",{staticClass:"ibox-content"},[e("div",{staticClass:"row",staticStyle:{"margin-bottom":"10px"}},[e("div",{staticClass:"col-md-12"},[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.keyWord,expression:"keyWord"}],staticClass:"input-sm form-control",attrs:{type:"text",placeholder:t.$t("el.form.review_filter_placeholder")},domProps:{value:t.keyWord},on:{input:function(a){a.target.composing||(t.keyWord=a.target.value)}}}),t._v(" "),e("span",{staticClass:"input-group-btn"},[e("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button"}},[t._v(" "+t._s(t.$t("el.page.search")))])])])])]),t._v(" "),e("table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"table table-hover"},[e("tbody",[t.applicatlist.length>0?t._l(t.applicatlist,function(a){return e("tr",{class:{current:t.$route.params.id==a.id}},[e("td",{staticClass:"project-status"},[e("Status",{attrs:{status:a.status}})],1),t._v(" "),e("td",{staticClass:"project-title"},[e("router-link",{attrs:{to:"/review/details/"+a.id}},[t._v("\n                          "+t._s(a.mechanism)+" - "+t._s(a.type)+"\n                        ")]),t._v(" "),e("br"),t._v(" "),e("small",[t._v(t._s(t.$t("el.table.created_at")+" ")),e("timeInterval",{attrs:{date:a.created_at}})],1)],1)])}):t._e(),t._v(" "),0==t.applicats.length?e("h3",{staticClass:"none text-center"},[t._v(t._s(t.$t("el.page.nothing")))]):t._e()],2)]),t._v(" "),e("nav",{staticClass:"text-center"},[t.applicats.length<1?e("div"):e("el-pagination",{attrs:{small:!0,"current-page":t.currentPage,layout:"prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)])])]),t._v(" "),t.applicats.length>0?[t.show?e("div",{staticClass:"col-md-8 col-xs-12"},[e("div",{staticClass:"wrapper wrapper-content animated fadeInUp"},[e("div",{staticClass:"ibox"},[e("div",{staticClass:"ibox-content"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-12"},[e("div",{staticClass:"m-b-md"},[e("h3",[t._v(t._s(t.applicat.mechanism)+" - "+t._s(t.applicat.type))])])])]),t._v(" "),e("div",{staticClass:"row m-t-sm"},[e("el-tabs",{staticClass:"tabs",attrs:{type:"card"},on:{"tab-click":t.forwardClick},model:{value:t.activeName,callback:function(a){t.activeName=a},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:t.$t("el.page.details"),name:"detail"}},[t.applicat?e("dl",{staticClass:"dl-horizontal"},[e("dt",[t._v(t._s(t.$t("el.table.status"))+"：")]),t._v(" "),e("dd",[e("Status",{attrs:{statusClass:!1,status:t.applicat.status}})],1),t._v(" "),e("dt",[t._v(t._s(t.$t("el.table.applicat_user"))+"：")]),t._v(" "),e("dd",[t._v(t._s(t.applicat.user))]),t._v(" "),e("dt",[t._v(t._s(t.$t("el.form.mechanism"))+"：")]),t._v(" "),e("dd",[t._v(t._s(t.applicat.mechanism))]),t._v(" "),e("dt",[t._v(t._s(t.$t("el.form.principal"))+"：")]),t._v(" "),e("dd",[t._v(t._s(t.applicat.principal))]),t._v(" "),e("dt",[t._v(t._s(t.$t("el.table.mobile"))+"：")]),t._v(" "),e("dd",[t._v(t._s(t.applicat.mobile))]),t._v(" "),e("dt",[t._v(t._s(t.$t("el.form.applay_type"))+"：")]),t._v(" "),e("dd",[t._v(t._s(t.applicat.type))]),t._v(" "),e("dt",[t._v(t._s(t.$t("el.form.participate_number"))+"：")]),t._v(" "),e("dd",[t._v(t._s(t.applicat.number))]),t._v(" "),e("dt",[t._v(t._s(t.$t("el.form.borrow_period"))+"：")]),t._v(" "),e("dd",[t._v(t._s(t.applicat.startTime)+" - "+t._s(t.applicat.endTime))]),t._v(" "),e("br"),t._v(" "),e("dt",[t._v(t._s(t.$t("el.form.applay_unite"))+"：")]),t._v(" "),e("dd",[t._v("\n                                      "+t._s(t.applicat.agency)+"\n                                    ")]),t._v(" "),e("br"),t._v(" "),e("dt",[t._v(t._s(t.$t("el.form.applay_reason"))+"：")]),t._v(" "),e("dd",[t._v("\n                                      "+t._s(t.applicat.reason)+"\n                                    ")]),t._v(" "),e("br"),t._v(" "),e("dt",[t._v(t._s(t.$t("el.form.goods"))+"：")]),t._v(" "),e("dd",[t._v(t._s(t.applicat.goods))]),t._v(" "),e("br"),t._v(" "),e("dt",[t._v(t._s(t.$t("el.form.activity_planning"))+"：")]),t._v(" "),t.applicat.files?e("dd",t._l(JSON.parse(t.applicat.files),function(a){return e("li",[e("a",{directives:[{name:"show",rawName:"v-show",value:a,expression:"file"}],staticClass:"filename",attrs:{href:a.url,title:a.original_name,target:"_blank"}},[e("i",{staticClass:"ion-document"}),t._v("\n                                          "+t._s(a.original_name)+"\n                                        ")])])})):t._e()]):t._e()]),t._v(" "),e("el-tab-pane",{attrs:{label:t.$t("el.page.review"),name:"second"}},[e("div",{staticClass:"feed-activity-list"},[t.applicat.opinions?t._l(t.applicat.opinions.data,function(a){return e("div",{staticClass:"feed-element"},[e("a",{staticClass:"pull-left",attrs:{href:"#"}},[e("img",{staticClass:"img-circle",attrs:{src:a.user.avatar,alt:""}})]),t._v(" "),e("div",{staticClass:"media-body"},[e("small",{staticClass:"pull-right"},[t._v(t._s(a.created_at))]),t._v(" "),e("strong",[t._v(t._s(a.user.name))]),t._v(" "),e("div",{staticClass:"well"},[t._v("\n                                                "+t._s(a.opinion)+"\n                                              ")])])])}):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"待审核"==t.applicat.status||"审核中"==t.applicat.status,expression:"applicat.status == '待审核' || applicat.status == '审核中'"}],staticClass:"feed-element"},[e("div",{staticClass:"media-body "},[e("form",{on:{submit:function(a){return a.preventDefault(),t.submit(a)}}},[e("el-input",{staticClass:"opinion",attrs:{type:"textarea",placeholder:t.$t("el.form.opinion_placeholder")},model:{value:t.form.opinion,callback:function(a){t.$set(t.form,"opinion",a)},expression:"form.opinion"}}),t._v(" "),e("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"/api/applicat/file",accept:"application/msword,application/msexcel,application/pdf",headers:t.headers,"on-remove":t.handleRemove,"on-success":t.handleSuccess,"before-upload":t.handleUpload,"file-list":t.fileList}},[e("el-button",{attrs:{size:"small",type:"primary"}},[t._v(t._s(t.$t("el.form.upload_btn")))]),t._v(" "),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e("span",{staticStyle:{"line-height":"15px"}},[t._v(t._s(t.$t("el.form.review_tip")))])])],1),t._v(" "),e("div",{},[e("el-radio-group",{model:{value:t.form.radio,callback:function(a){t.$set(t.form,"radio",a)},expression:"form.radio"}},[e("el-radio-button",{attrs:{label:t.$t("el.form.pass")}}),t._v(" "),e("el-radio-button",{attrs:{label:t.$t("el.form.no_pass")}})],1),t._v(" "),e("button",{staticClass:"btn btn-info btn-sm",staticStyle:{float:"right"},attrs:{type:"submit",disabled:!(t.form.radio&&t.form.opinion)}},[t._v(t._s(t.$t("el.form.submit")))])],1)],1)])])],2)]),t._v(" "),e("el-tab-pane",{staticClass:"forward",attrs:{label:t.$t("el.page.forwarding"),name:"forward"}},[e("el-form",{attrs:{"label-position":"top",model:t.forward_form,"label-width":"80px"}},[e("el-form-item",{attrs:{label:t.$t("el.form.recipient")}},[t.isPhone?e("select",{directives:[{name:"model",rawName:"v-model",value:t.forward_form.role_id,expression:"forward_form.role_id"}],staticClass:"form-control",attrs:{placeholder:t.$t("el.form.recipient_placeholder")},on:{change:function(a){var e=Array.prototype.filter.call(a.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.forward_form,"role_id",a.target.multiple?e:e[0])}}},t._l(t.roles,function(a){return e("option",{key:a.id,domProps:{value:a.id}},[t._v("\n                                            "+t._s(a.display_name)+"\n                                          ")])})):e("el-select",{attrs:{placeholder:t.$t("el.form.recipient_placeholder")},model:{value:t.forward_form.role_id,callback:function(a){t.$set(t.forward_form,"role_id",a)},expression:"forward_form.role_id"}},t._l(t.roles,function(t){return e("el-option",{key:t.id,attrs:{label:t.display_name,value:t.id}})}))],1),t._v(" "),e("el-input",{staticClass:"opinion",attrs:{type:"textarea",placeholder:t.$t("el.form.opinion_placeholder")},model:{value:t.forward_form.opinion,callback:function(a){t.$set(t.forward_form,"opinion",a)},expression:"forward_form.opinion"}}),t._v(" "),e("el-form-item",[e("el-button",{staticClass:"btn btn-info btn-sm",staticStyle:{float:"right"},attrs:{type:"primary",disabled:!t.forward_form.role_id},on:{click:t.forward}},[t._v(t._s(t.$t("el.form.submit")))])],1)],1)],1),t._v(" "),"审核通过"==t.applicat.status?e("el-tab-pane",{attrs:{label:t.$t("el.page.approval")}},[e("div",[t._v("\n                                    "+t._s(t.$t("el.page.borrow_period"))+": "+t._s(t.applicat.startTime)+" - "+t._s(t.applicat.endTime)+"\n                                  ")]),t._v(" "),e("button",{staticClass:"btn btn-info",attrs:{type:"button",name:"button"},on:{click:function(a){t.approval(t.applicat)}}},[t._v(t._s(t.$t("el.page.approval")))])]):t._e(),t._v(" "),"进行中"==t.applicat.status?e("el-tab-pane",{attrs:{label:t.$t("el.page.approval")}},[e("div",{},[t._v("\n                                    "+t._s(t.applicat.endTime)+"\n                                  ")]),t._v(" "),e("button",{staticClass:"btn btn-info",attrs:{type:"button",name:"button"},on:{click:function(a){t.end(t.applicat)}}},[t._v(t._s(t.$t("el.page.end")))])]):t._e(),t._v(" "),"待评价"==t.applicat.status?e("el-tab-pane",{attrs:{label:t.$t("el.page.appraisal")}},[e("div",{staticClass:"block"},[e("el-input",{attrs:{type:"textarea",placeholder:t.$t("el.page.feedback")},model:{value:t.appraisal_form.appraisal,callback:function(a){t.$set(t.appraisal_form,"appraisal",a)},expression:"appraisal_form.appraisal"}}),t._v(" "),e("el-rate",{attrs:{"show-text":"",colors:["#99A9BF","#F7BA2A","#FF9900"]},model:{value:t.appraisal_form.score,callback:function(a){t.$set(t.appraisal_form,"score",a)},expression:"appraisal_form.score"}}),t._v(" "),e("button",{staticClass:"btn btn-info pull-right",attrs:{type:"button",disabled:!t.appraisalCanSubmit,name:"button"},on:{click:function(a){t.appraisal(t.applicat)}}},[t._v(t._s(t.$t("el.form.submit")))])],1)]):t._e()],1)],1)])])])]):t._e()]:t._e()],2)])},staticRenderFns:[]}},qLXb:function(t,a,e){var i=e("VU/8")(e("b3bp"),e("WWaS"),!1,function(t){e("8njy")},null,null);t.exports=i.exports},qe6d:function(t,a){t.exports={render:function(){var t=this.$createElement;return(this._self._c||t)("span",{staticStyle:{"margin-bottom":"0"}},[this._v(this._s(this.timeinterval))])},staticRenderFns:[]}},ruFp:function(t,a,e){var i=e("thUX");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);e("rjj0")("40d67a44",i,!0,{})},thUX:function(t,a,e){(t.exports=e("FZ+f")(!1)).push([t.i,"",""])}});